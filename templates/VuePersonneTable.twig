<!doctype html>
<html lang="fr">
	<head>
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=0.6"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">		<title>Gestion de la table</title>
		
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
			
			 <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
			 <script src="https://unpkg.com/htmx.org@latest/dist/htmx.min.js"></script>
	</head>

	<body>
		<div class="container-fluid">
		
			
			<div class="row">
			
			Bonjour {{prenom}}, <br> vous êtes en charge d'inserer les scores pour le terrain  {{terrain}}
			</div> 

			<div class="row">
				<div class="col-12" id="score">
					<table class="table table-striped table-responsive" >
						<thead>
							<tr>
							
							<th scope="col" class="text-center">Heure</th>
							<th scope="col" class="w-25 text-center">Score equipe1</th>
							<th scope="col" class="w-25 text-center">Score equipe2</th>
							<th scope="col">Arbitre</th>
							<th scope="col"></th>
							</tr>
						</thead>
						
					<tbody>	
					{% for planification in AffichagePlanification %}
					<tr id="planification-{{ planification.rencontre_id }}">					

					{% if planification.rencontre_id is not null %}

					<td class="text-center"><h3 class="">{{planification.creneau_nom}}</h3>
					</td>

<form action="vuePersonneTable_traitement.php" method="get" hx-target="#row-{{planification.rencontre_id}}">
  <input type="hidden" name="return_id" value="row-{{planification.rencontre_id}}">
  <td class="text-center">
    <img src="{{planification.club1_logo}}" class="img-fluid rounded">
    <p class="lead text-uppercase">{{planification.equipe1_nom}}</p>
    
    <!-- Champ caché pour scoreEquipe1 -->
    <input type="hidden" name="scoreEquipe1" value="{{planification.score1}}" id="scoreEquipe1{{planification.rencontre_id}}">
    
    <!-- Affichage visuel du score pour l'équipe 1 -->
    <p>Score: <span id="displayScoreEquipe1{{planification.rencontre_id}}">{{planification.score1}}</span></p>
    
    <!-- Boutons pour ajouter ou retirer un but -->
    <button type="button" class="btn btn-success" hx-post="vuePersonneTable_traitement.php?action=addGoal&idRencontre={{planification.rencontre_id}}&team=1" hx-trigger="click" 
	hx-swap="innerHTML" 
	hx-target="#displayScoreEquipe1{{planification.rencontre_id}}">But +</button>
    <button type="button" class="btn btn-danger" hx-post="vuePersonneTable_traitement.php?action=removeGoal&idRencontre={{planification.rencontre_id}}&team=1" hx-trigger="click" hx-swap="innerHTML" hx-target="#displayScoreEquipe1{{planification.rencontre_id}}">But -</button>
  </td>

  <td class="text-center">
    <img src="{{planification.club2_logo}}" class="img-fluid rounded">
    <p class="lead text-uppercase">{{planification.equipe2_nom}}</p>
    
    <!-- Champ caché pour scoreEquipe2 -->
    <input type="hidden" name="scoreEquipe2" value="{{planification.score2}}" id="scoreEquipe2{{planification.rencontre_id}}">
    
    <!-- Affichage visuel du score pour l'équipe 2 -->
    <p>Score: <span id="displayScoreEquipe2{{planification.rencontre_id}}">{{planification.score2}}</span></p>
    
    <!-- Boutons pour ajouter ou retirer un but -->
    <button type="button" class="btn btn-success" hx-post="vuePersonneTable_traitement.php?action=addGoal&idRencontre={{planification.rencontre_id}}&team=2" hx-trigger="click" hx-swap="innerHTML" hx-target="#displayScoreEquipe2{{planification.rencontre_id}}">But +</button>
    <button type="button" class="btn btn-danger" hx-post="vuePersonneTable_traitement.php?action=removeGoal&idRencontre={{planification.rencontre_id}}&team=2" hx-trigger="click" hx-swap="innerHTML" hx-target="#displayScoreEquipe2{{planification.rencontre_id}}">But -</button>
  </td>

  <td>{{planification.arbitre_nom}}</td>
  <td class="text-center align-middle">
    <!--<button type="submit" class="btn btn-primary">Soumettre</button> -->
  </td>
</form>




					
					
					
					{% elseif planification.label_description is not null %}
					
					
					
					<td class="w-25 text-center"><h3>{{planification.creneau_nom}}</h3></td>
					<td class="w-25 text-center">{{planification.label_description}} </td>
					<td><p>{{planification.label_description}}<p> </td>
					<td></td>

					{% endif %}
					</tr>
					{% endfor %}
					</tbody>
					
				</table>




			

			</div>
		</div>


<!-- Modale Bootstrap pour les scores manquants -->



<!-- Modale Bootstrap 5 pour les scores manquants -->
{% if missingScore == "missing_score" %}
<div class="modal fade" id="missingScoreModal" tabindex="-1" aria-labelledby="missingScoreModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="missingScoreModalLabel">Attention</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Un ou plusieurs scores sont manquants. Veuillez les remplir avant de soumettre le formulaire.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
      </div>
    </div>
  </div>
</div>

{% endif %}



	</body>




</html>




<script>
document.addEventListener("DOMContentLoaded", function() {
    // Sélectionner tous les inputs dans le formulaire qui ont une valeur définie
    const inputs = document.querySelectorAll('input[type="number"]');

    inputs.forEach(function(input) {
        // Si l'input a une valeur non vide, on le désactive
        if (input.value.trim() !== "") {
            input.readOnly  = true;
			 // Appliquer le style directement en JavaScript
                input.style.backgroundColor = '#f0f0f0'; // Gris clair
                input.style.color = '#6c757d'; // Couleur du texte pour un contraste avec le fond
                input.style.borderColor = '#ced4da'; // Couleur de la bordure
        }
    });
});

</script>


	<script>
$(document).ready(function(){
    // Vérifie si la modale doit être affichée
    if ($("#missingScoreModal").length) {
        $("#missingScoreModal").modal('show');
    }
});
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form'); // Cibler le formulaire spécifique si nécessaire

        if (form) {
            form.addEventListener('submit', function() {
                sessionStorage.setItem('scrollPosition', window.scrollY);
            });
        }
    });



</script>



