<html lang="fr">
	<head>
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"/>
		<link href="style/couleurEquipes.css" rel="stylesheet">
		<script src="https://unpkg.com/htmx.org@2.0.1" integrity="sha384-QWGpdj554B4ETpJJC9z+ZHJcA/i59TyjxEPXiiUgN2WmTyV5OEZWCD6gQhgkdpB/" crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
		<script src="https://unpkg.com/htmx.org/dist/ext/debug.js"></script>
		<title>Gestion rencontre</title>
	</head>

	<body>

		  {{ include('header.twig') }}
      <div class="row ml-n4">
      <div class="col-lg-3">
         {% for tournoi in ListeDesTournois %}
         {% if tournoi.isArchived == 0 %}
         {% if tournoi.id == idTournoi %}
         <a href="gestionToutesLesRencontres.php?id_tournoi={{ tournoi.id }}" class="btn btn-success btn-sm">{{ tournoi.nom }}</a>
         {% else %}
         <a href="gestionToutesLesRencontres.php?id_tournoi={{ tournoi.id }}" class="btn btn-secondary">{{ tournoi.nom }}</a>
         {% endif %}
         {% endif %}
         {% endfor %}
      </div>
      <div class="col-lg-12">
         <table class="table" id="planification-table">
            <thead>
               <tr>
                  <th scope="col">
                  
                  </th>
                  

                 

                  {% for i in 0..terrains|length - 1 %}
                       <th scope="col">{{terrains[i]["nom"]}}</th>
                {% endfor %}
                  
               </tr>
            </thead>
            <tbody>
               {% for creneau in listCreneaux %}
               <tr>
                  <td>
                  
                  <div class="input-group flex-nowrap">
                           <span class="input-group-text" id="addon-wrapping"><a href="PlacementDesRencontresTraitement.php?action=delCreneau&creneauId={{creneau.creneau_id}}"><i class="fa fa-clock-o" aria-hidden="true"></i></span></a>
                           <input type="text" size="3" class="form-control" placeholder="{{ creneau.nom }}" aria-describedby="addon-wrapping">
                           </div>
                  
                  </td>
                  {% set Displayed = false %}
                  {% for j in 0..terrains|length - 1 %}
                  <td>
                     {% set planificationFound = false %} {# Variable pour suivre si une planification a été trouvée #}
                     {% set creneauOqp = false %} {# Variable pour suivre si un creneau est OQP #}
                     {% for planification in afficherPlanification %}
					
                     	{% if planification.terrain_id == terrains[j]['terrain_id'] and planification.creneau_id == creneau.creneau_id  %}
                    	      {% set planificationFound = true %} {# Variable pour suivre si une planification a été trouvée #}
                    		    {% if planification.rencontre_id is not null or planification.arbitre_id is not null   %}
                    		      {% if planification.arbitre_id is not null %}
                              <!-- SI il y a un arbitre selectonné il s'affiche ici avec la possibilité de le supprimer -->
                   			 <i class="fa fa-user" aria-hidden="true"></i> {{planification.arbitre_nom}}
                             
	
                     {% endif %}
                     {% if planification.rencontre_id is not null %}
				<div class="mb-3">
    <!-- Ligne 1: Catégorie de l'équipe 1 et tour -->
    <p class="fw-bold text-center">{{planification.equipe1_categorie_nom}} - tour {{planification.tour}}</p>
    
    <!-- Ligne 2: Noms des équipes et scores, centrée -->
    <div class="d-flex align-items-center justify-content-center">
        <p class="mb-0 me-2">{{planification.equipe1_nom}}</p>
        
        <input type="hidden" name="idRencontre" value="{{planification.rencontre_id}}" id="idRencontre{{planification.rencontre_id}}">
        
        <input type="number" name="scoreEquipe1" value="{{planification.score1}}" class="form-control me-2" min="0"
            hx-post="gestionRencontres_traitement.php"
            hx-trigger="change" 
            hx-include="#idRencontre{{planification.rencontre_id}}">

        <span class="mx-2">vs</span>

        <input type="number" name="scoreEquipe2" value="{{planification.score2}}" class="form-control me-2" min="0"
            hx-post="gestionRencontres_traitement.php"
            hx-trigger="change" 
            hx-include="#idRencontre{{planification.rencontre_id}}">

        <p class="mb-0">{{planification.equipe2_nom}}</p>
    </div>
</div>

                    
                     {% set creneauOqp = true %}
                     {% endif %}
                     <script>
                        var tdElement = document.currentScript.parentElement;
                        // Appliquer la couleur de fond au <td> parent
                        tdElement.style.backgroundColor = '{{planification.equipe1_categorie_couleur}}';														
                     </script>
                     
                     {% elseif planification.label_id is not null %}
                      {{ planification.label_description }}
					  <script>
                        var tdElement = document.currentScript.parentElement;
                        // Appliquer la couleur de fond au <td> parent
                        tdElement.style.backgroundColor = 'grey';														
                     </script>
                     {% endif %}


                     {% endif %}
                       
                     {% endfor %}
                 
                    
                     
                  </td>
                  {% endfor %}
               </tr>
               {% endfor %}
            <tfoot>
               <td>
                  <a href="PlacementDesRencontresTraitement.php?action=addCreneau&idTournoi={{idTournoi}}&startTime={{lastCreneau['nom']}}&newTime={{timeNextCreneau}}"><h2><p class="text-success"><i class="fa fa-plus-circle" aria-hidden="true"></i></p></h2></a>
               </td>
            </tfoot>
            </tbody>
            </tbody>
         </table>
      </div>
 <input type="text" id="filter-input" placeholder="Filtrer...">  

<script>
        // Load the filter value from LocalStorage on page load
        document.addEventListener('DOMContentLoaded', function() {
            const filterInput = document.getElementById('filter-input');
            const storedFilter = localStorage.getItem('filterValue');
            if (storedFilter) {
                filterInput.value = storedFilter;
                filterOptions(storedFilter.toLowerCase());
            }

            filterInput.addEventListener('input', function() {
                const filter = this.value.toLowerCase();
                localStorage.setItem('filterValue', this.value); // Save filter value to LocalStorage
                filterOptions(filter);
            });
        });

        function filterOptions(filter) {
            const selects = document.querySelectorAll('select');
            selects.forEach(select => {
                const options = select.querySelectorAll('option');
                options.forEach(option => {
                    if (option.text.toLowerCase().includes(filter)) {
                        option.classList.remove('hidden');
                    } else {
                        option.classList.add('hidden');
                    }
                });
            });
        }
    </script>


<script>
        $(document).ready(function() {
            $('.rencontreLabel .form-select').on('change', function() {
                var $form = $(this).closest('form');
                var formAction = $form.attr('action');
                var formData = $form.serialize();
                
                $.post(formAction, formData, function() {
                    location.reload();
                });
            });
        });
    </script>


